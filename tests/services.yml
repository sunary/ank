
services:

  WorkerClass:
    class: processor.FirstApp
    arguments: [$Mongodb, $Redis, '%batch_size%']

  Mongodb:
    class: utilities.my_mongo.Mongodb
    arguments: ['%mongo_db%', '%mongo_col%', '%mongo_host%', '%mongo_port%']

  Redis:
    class: redis.client.StrictRedis
    arguments: ['%redis_host%', '%redis_port%']

  SecondWorker:
    class: processor.SecondApp
    arguments: ~

  ConditionalWorker:
    class: processor.ConditionalWorker
    arguments: ~

  ThirdWorker:
    class: processor.ThirdApp
    arguments: ~

  OtherWorker:
    class: processor.OtherApp
    arguments: ~

  LogApp:
    class: apps.log_app.LogApp
    arguments: ~

  JoinProcessor:
    class: apps.join_app.JoinApp
    arguments: '%batch_size%'

  SplitProcessor:
    class: apps.split_app.SplitApp
    arguments: ~


chains:
  - WorkerClass
  - JoinProcessor
  - LogApp
  - SecondWorker
  - SplitProcessor
  - ConditionalWorker
  - [ThirdWorker, OtherWorker]
  - LogApp